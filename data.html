<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agricultural Commodities Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: black; color: white; }
        header { background-color: #4CAF50; color: white; padding: 15px; text-align: center; }
        nav a { margin: 0 15px; text-decoration: none; color: white; font-weight: bold; }
        h2 { text-align: center; color: #4CAF50; }
        table { width: 95%; margin: 30px auto; border-collapse: collapse; box-shadow: 0 4px 8px rgba(0,0,0,0.5); background-color: #1a1a1a; }
        th, td { border: 1px solid #444; padding: 12px; text-align: left; }
        th { background-color: #333; color: #f2f2f2; }
        .change-up { color: lightgreen; font-weight: bold; }
        .change-down { color: #ff6666; font-weight: bold; }
        .note { text-align: center; margin-top: 20px; color: #ccc; }
    </style>
</head>
<body>
    <header>
        <h1>France Farms</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="data.html">Commodity Data</a>
            <a href="demographics.html">T&T Data Viz</a>
        </nav>
    </header>

    <h2>Global Agricultural & Related Futures Prices (Live Data)</h2>
    <div id="data-container">
        <p class="note" id="status-message">Fetching live market data...</p>
    </div>
    
    <script>
        const API_ENDPOINT = 'https://france-farms-data.com/api/commodities'; // <-- YOU MUST REPLACE THIS URL!
        const FETCH_INTERVAL = 30000; // 30 seconds

        const container = document.getElementById('data-container');
        const statusMessage = document.getElementById('status-message');

        function displayCommodities(data) {
            let html = '<table>';
            html += '<thead><tr><th>Commodity</th><th>Price</th><th>Unit</th><th>Daily Change</th><th>Source</th></tr></thead>';
            html += '<tbody>';
            
            // Sorting the data by name before rendering to ensure dynamic alphabetical order
            data.sort((a, b) => a.name.localeCompare(b.name));

            data.forEach(item => {
                // Determine CSS class for color based on price change
                // Note: Assumes change is a string like "+0.03" or "-0.01"
                const changeClass = item.change.startsWith('+') ? 'change-up' : 'change-down';
                
                // Simple currency symbol formatting
                let displayPrice = `$${item.price.toFixed(2)}`;
                if (item.unit && item.unit.startsWith('EUR')) {
                    displayPrice = `â‚¬${item.price.toFixed(2)}`;
                } else if (item.unit && item.unit.startsWith('CAD')) {
                    displayPrice = `C$${item.price.toFixed(2)}`;
                }

                html += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${displayPrice}</td>
                        <td>${item.unit || 'N/A'}</td>
                        <td class="${changeClass}">${item.change || 'N/A'}</td>
                        <td>${item.source || 'API'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            // Replace the entire content to update the table
            container.innerHTML = html; 
            
            // Add a status note below the table
            const updateTime = new Date().toLocaleTimeString();
            container.insertAdjacentHTML('beforeend', `<p class="note">Last updated from external API: ${updateTime}. Next fetch in ${FETCH_INTERVAL / 1000} seconds.</p>`);
        }

        async function fetchCommodityData() {
            try {
                // Show fetching status
                statusMessage.textContent = "Fetching live market data...";
                statusMessage.style.color = 'yellow';

                const response = await fetch(API_ENDPOINT);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                // Your API must return a JSON array like the mock data:
                // [{ name: 'Cocoa', price: 8500.00, unit: 'USD/ton', change: '+25.00', source: 'ICE' }, ...]
                const liveData = await response.json();
                
                if (liveData && liveData.length > 0) {
                    displayCommodities(liveData);
                    // Hide status message after successful fetch
                    statusMessage.style.display = 'none';
                } else {
                    throw new Error('API returned an empty data set.');
                }
                
            } catch (error) {
                console.error("Failed to fetch live commodity data:", error);
                // Display error message
                statusMessage.style.display = 'block';
                statusMessage.textContent = `Error fetching data: ${error.message}. Displaying mock data (if available).`;
                statusMessage.style.color = '#ff6666';
                
                // Optional: Fallback to static mock data if the API fails
                // You would define the mock data array here if you want a reliable fallback.
            }
        }

        // Run the function immediately and then at the set interval
        fetchCommodityData();
        setInterval(fetchCommodityData, FETCH_INTERVAL);

    </script>
</body>
</html>
